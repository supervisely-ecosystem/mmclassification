<sly-card class="mt15"
          title="7. Traning hyperparameters"
          subtitle="Task progress, detailed logs, metrics charts, and other visualizations">
    <sly-field title="GPU device id(s)"
               description="Cuda device(s), i.e. 0 or 0,1,2,3">
        <el-input v-model="state.gpusIds" style="width:250px;"></el-input>
    </sly-field>
    <sly-field title="Number of epochs">
        <el-input-number v-model="state.epochs" :min="1" :max="10000"></el-input-number>
    </sly-field>
    <sly-field title="Input image size (in pixels)"
               description="Image is resized to square">
        <el-input-number v-model="state.imgSize" :min="64"></el-input-number>
    </sly-field>
    <sly-field title="Batch size per GPU"
               description="number of samples for a single GPU">
        <el-input-number v-model="state.batchSizePerGPU" :min="4"></el-input-number>
    </sly-field>
    <sly-field title="Number of workers per GPU"
               description="Maximum number of dataloader workers, use 0 for debug">
        <el-input-number v-model="state.workersPerGPU" :min="0"></el-input-number>
    </sly-field>
    <sly-field title="Validation interval"
               description="By default we evaluate the model on the validation set after each epoch, you can change the evaluation interval">
        <div class="fflex">
            <span class="mr5">Evaluate validation set every </span>
            <el-input-number v-model="state.valInterval" :min="1" :max="state.epochs"></el-input-number>
            <span class="ml5">epochs</span>
        </div>
    </sly-field>
    <sly-field title="Logging frequency"
               description="How often metrics should be logged, increase if training data is small">
        <div class="fflex">
            <span class="mr5">Log metrics every </span>
            <el-input-number v-model="state.metricsPeriod" :min="1" :max="state.epochs"></el-input-number>
            <span class="ml5">epochs</span>
        </div>
    </sly-field>
    <sly-field title="Optimizer"
               description="Choose optimizer and its settings">
        <div>
            Learn mode in official
            <a href="https://pytorch.org/docs/1.7.1/optim.html?module-torch.optim" target="_blank">
                pytorch documentation
            </a>
        </div>
        <el-select class=mt10 v-model="state.optimizer">
            <el-option key="SGD" label="SGD" value="SGD"></el-option>
            <el-option key="Adam" label="Adam" value="Adam"></el-option>
            <el-option key="AdamW" label="AdamW" value="AdamW"></el-option>
        </el-select>
    </sly-field>
    <sly-field title="Learning rate">
        <el-input-number v-model="state.lr" :min="0" :step="0.0005" :debounce="1000"></el-input-number>
    </sly-field>
    <sly-field v-if="state.optimizer === 'SGD'" title="Momentum">
        <el-input-number v-model="state.momentum" :min="0" :step="0.05" :debounce="1000"></el-input-number>
    </sly-field>
    <sly-field title="Weight decay">
        <el-input-number v-model="state.weightDecay" :min="0" :step="0.0001" :debounce="1000"></el-input-number>
    </sly-field>
    <sly-field v-if="state.optimizer === 'SGD'" title="Nesterov">
        <el-switch v-model="state.nesterov" on-color="#13ce66" off-color="#B8B8B8"></el-switch>
    </sly-field>

    <sly-field title="Clip gradient norm">
        <el-switch v-model="state.gradClipEnabled" on-color="#13ce66" off-color="#B8B8B8"></el-switch>
        <div class="fflex mt10">
            <div class="mr5">max_norm =</div>
            <el-input-number :disabled="!state.gradClipEnabled"
                             v-model="state.maxNorm" :min="0" :step="0.1" :debounce="1000">
            </el-input-number>
        </div>
    </sly-field>

    <sly-field title="Learning Policy" description="configure learning rate schedule in python (for advanced users)">
        <el-switch v-model="state.lrPolicyEnabled" on-color="#13ce66" off-color="#B8B8B8"></el-switch>
        <sly-copy-to-clipboard class="mt10" v-if="state.lrPolicyEnabled" :data="state.lrPolicyPyConfig">
            <sly-editor v-model="state.lrPolicyPyConfig"
                        :options="{'mode': 'ace/mode/python', 'readOnly': false, 'maxLines': 100}">
            </sly-editor>
        </sly-copy-to-clipboard>
    </sly-field>
</sly-card>

<sly-card class="mt15"
          title="8. Preview entire training configuration"
          subtitle="Training settings in MMClassification is a set of python configs. These configs will be saved to
              Team Files along with other training artifacts. Learn more in app readme.">
    <div slot="header">
        <el-button type="primary" class="regular"
                   @click="command('preview_configs')"
                   :disabled="state.selectedTags.length === 0 || state.started === true">
            Preview
        </el-button>
    </div>
    <div v-if="data.modelPyConfig.length === 0">
        <i class="zmdi zmdi-help" style="color: orange"></i> Press Preview button to generate and visualize training configuration (python scripts)
    </div>
    <div v-show="state.selectedTags.length === 0" class="mt10" style="color: red">
        0 training tags are selected at step #2
    </div>
    <sly-field title="Model config" v-if="data.modelPyConfig.length > 0">
        <sly-copy-to-clipboard :data="data.modelPyConfig">
            <sly-editor v-model="data.modelPyConfig"
                        :options="data.pyViewOptions">
            </sly-editor>
        </sly-copy-to-clipboard>
    </sly-field>
    <sly-field title="Dataset config" v-if="data.datasetPyConfig.length > 0">
        <sly-copy-to-clipboard :data="data.datasetPyConfig">
            <sly-editor v-model="data.datasetPyConfig"
                        :options="data.pyViewOptions">
            </sly-editor>
        </sly-copy-to-clipboard>
    </sly-field>
    <sly-field title="Optimizer and schedule config" v-if="data.schedulePyConfig.length > 0">
        <sly-copy-to-clipboard :data="data.schedulePyConfig">
            <sly-editor v-model="data.schedulePyConfig"
                        :options="data.pyViewOptions">
            </sly-editor>
        </sly-copy-to-clipboard>
    </sly-field>
    <sly-field title="Runtime config" v-if="data.runtimePyConfig.length > 0">
        <sly-copy-to-clipboard :data="data.runtimePyConfig">
            <sly-editor v-model="data.runtimePyConfig"
                        :options="data.pyViewOptions">
            </sly-editor>
        </sly-copy-to-clipboard>
    </sly-field>
    <sly-field title="Train config" v-if="data.trainPyConfig.length > 0">
        <sly-copy-to-clipboard :data="data.trainPyConfig">
            <sly-editor v-model="data.trainPyConfig"
                        :options="data.pyViewOptions">
            </sly-editor>
        </sly-copy-to-clipboard>
    </sly-field>

</sly-card>
